# 功能规格说明：蓝牙耳机语言播放逻辑优化

**功能分支**: `001-earphone-language-logic`  
**创建日期**: 2025-10-21  
**状态**: 草案  
**输入**: 用户描述: "我有一个翻译app，用户可以连接蓝牙耳机使用，我需要厘清用户连接耳机后在耳机里默认播放哪种语言的逻辑。目前在用户连接了蓝牙耳机的情况下，我们是默认在耳机里播放用户的系统语言，也就是我们默认语言对的第一个语言（左边的语言），用户是可以切换语言的，也可以改变语言对的顺序（即把系统默认语言放在右边）。现在有用户邮件询问我们不知道要怎么设置耳机播放的语言，我们在首页和语音页面右上角的设置里都可以更改耳机里播放的语言。"

## 用户场景与测试 *(必填)*

### 用户故事 1 - 首次连接耳机时的默认播放语言 (优先级: P1)

用户首次连接蓝牙耳机到翻译应用时，系统应该自动选择一个合理的默认语言在耳机中播放。当前逻辑是：播放用户系统语言（即语言对左侧的语言）。

**优先级理由**: 这是最核心的功能，直接影响用户首次使用体验。默认行为必须符合用户预期且清晰易懂。

**独立测试**: 可以通过以下方式独立测试：使用不同系统语言的设备，首次连接蓝牙耳机，验证耳机播放的语言是否为系统语言（语言对左侧）。

**验收场景**:

1. **假设** 用户系统语言为中文，当前语言对为"中文-英文"，**当** 用户首次连接蓝牙耳机，**则** 耳机默认播放中文翻译结果
2. **假设** 用户系统语言为英文，当前语言对为"英文-日文"，**当** 用户首次连接蓝牙耳机，**则** 耳机默认播放英文翻译结果
3. **假设** 用户系统语言为中文，但当前语言对为"英文-中文"（系统语言在右侧），**当** 用户首次连接蓝牙耳机，**则** 耳机默认播放英文（左侧语言）

---

### 用户故事 2 - 手动切换耳机播放语言 (优先级: P1)

用户需要能够在连接蓝牙耳机后，主动切换耳机中播放的语言（在语言对的两种语言之间切换）。用户可以通过首页或语音页面右上角的设置来更改。

**优先级理由**: 这是核心功能的必要补充。用户可能需要根据不同场景切换耳机播放的语言，这直接影响应用的可用性。

**独立测试**: 可以通过以下方式独立测试：连接蓝牙耳机后，在首页或语音页面设置中切换耳机播放语言，验证切换是否立即生效。

**验收场景**:

1. **假设** 用户已连接蓝牙耳机，当前语言对为"中文-英文"，耳机播放中文，**当** 用户通过首页设置切换耳机语言为英文，**则** 耳机开始播放英文翻译结果
2. **假设** 用户已连接蓝牙耳机，当前语言对为"中文-英文"，耳机播放英文，**当** 用户通过语音页面右上角设置切换耳机语言为中文，**则** 耳机开始播放中文翻译结果
3. **假设** 用户在首页设置了耳机播放语言为英文，**当** 用户切换到语音页面，**则** 耳机继续播放英文（设置在不同页面间保持一致）

---

### 用户故事 3 - 更改语言对顺序后的耳机播放行为 (优先级: P2)

用户可以更改语言对的顺序（例如从"中文-英文"切换到"英文-中文"）。当用户更改语言对顺序后，耳机播放语言的行为需要明确定义。

**优先级理由**: 这是影响用户体验一致性的重要功能，但相比基础的默认行为和手动切换，使用频率较低。

**独立测试**: 可以通过以下方式独立测试：连接蓝牙耳机并设置耳机播放特定语言，然后切换语言对顺序，验证耳机播放语言的变化是否符合预期逻辑。

**验收场景**:

1. **假设** 用户已连接蓝牙耳机，当前语言对为"中文-英文"，耳机播放中文，**当** 用户将语言对切换为"英文-中文"（即交换顺序），**则** [NEEDS CLARIFICATION: 耳机应继续播放中文（保持用户选择），还是切换为英文（跟随左侧语言）？]
2. **假设** 用户已连接蓝牙耳机，当前语言对为"中文-英文"，耳机播放英文，**当** 用户将语言对切换为"日文-韩文"（完全更换语言对），**则** [NEEDS CLARIFICATION: 耳机应播放哪种语言？默认左侧（日文）还是保持用户之前的"非系统语言"选择倾向？]

---

### 用户故事 4 - 设置的可发现性和明确性 (优先级: P1)

用户需要能够轻松找到并理解如何设置耳机播放的语言。当前用户反馈表明设置不够明确，导致用户不知道如何更改。

**优先级理由**: 这是当前用户痛点的直接体现，影响用户满意度和应用易用性。即使功能逻辑正确，如果用户找不到设置，功能价值也无法体现。

**独立测试**: 可以通过用户测试验证：让新用户在连接蓝牙耳机后，尝试更改耳机播放语言，记录成功率和所需时间。

**验收场景**:

1. **假设** 用户已连接蓝牙耳机，在首页，**当** 用户查找耳机语言设置，**则** 用户能在30秒内找到设置入口
2. **假设** 用户已连接蓝牙耳机，在语音页面，**当** 用户点击右上角设置图标，**则** 用户能看到清晰的耳机播放语言选项
3. **假设** 用户未连接蓝牙耳机，**当** 用户查看语言设置，**则** [NEEDS CLARIFICATION: 耳机语言设置是否应该隐藏、置灰还是显示但带提示？]

---

### 边界情况

- 当用户连接蓝牙耳机后，耳机连接断开再重新连接，耳机播放语言是保持用户上次的选择还是重置为默认？
- 当用户同时连接多个蓝牙设备（例如耳机和音箱），如何确定播放设备和对应的语言设置？
- 当用户切换语言对为不包含系统语言的组合（例如系统是中文，但语言对是"日文-韩文"），首次连接耳机时的默认播放语言是什么？
- 当应用在后台运行时，用户通过系统设置断开并重新连接蓝牙耳机，应用是否能正确恢复耳机播放语言设置？
- 当用户在语音播放过程中切换耳机播放语言，当前正在播放的内容是否会中断并切换？

## 需求 *(必填)*

### 功能需求

- **FR-001**: 系统必须在用户首次连接蓝牙耳机时，默认在耳机中播放语言对左侧的语言（通常为用户系统语言）
- **FR-002**: 系统必须允许用户在首页和语音页面的设置中手动选择耳机播放的语言（在当前语言对的两种语言之间选择）
- **FR-003**: 系统必须在用户切换耳机播放语言后，立即应用新的语言设置到后续的翻译播放
- **FR-004**: 系统必须在不同页面（首页、语音页面）之间保持耳机播放语言设置的一致性
- **FR-005**: 系统必须在用户更改语言对时，根据明确的逻辑处理耳机播放语言的变化（具体逻辑待明确）
- **FR-006**: 系统必须在耳机断开连接后重新连接时，恢复用户上次选择的耳机播放语言设置
- **FR-007**: 系统必须在设置界面中清晰展示当前耳机播放的语言，并提供易于理解的切换选项
- **FR-008**: 系统必须在用户未连接蓝牙耳机时，适当地处理耳机语言设置的显示和交互（具体行为待明确）

### 核心实体

- **语言对**: 用户选择的两种语言组合，包含左侧语言和右侧语言，用于翻译功能
- **系统语言**: 用户设备的操作系统语言，通常对应语言对的左侧语言
- **耳机播放语言偏好**: 用户选择的在蓝牙耳机中播放的语言，取值为当前语言对中的某一种语言
- **蓝牙耳机连接状态**: 蓝牙耳机的连接/断开状态，影响耳机播放功能的可用性

## 成功标准 *(必填)*

### 可衡量的成果

- **SC-001**: 90% 的新用户在首次连接蓝牙耳机后，无需额外操作即可听到符合预期的默认语言播放
- **SC-002**: 用户能够在 15 秒内找到并完成耳机播放语言的切换操作
- **SC-003**: 耳机播放语言切换后，下一次翻译播放能够立即使用新的语言设置（延迟不超过 1 秒）
- **SC-004**: 关于"如何设置耳机播放语言"的用户支持请求减少 70%
- **SC-005**: 用户在更改语言对或重新连接耳机后，耳机播放语言行为的可预测性达到 95%（通过用户测试验证）

## 假设

- 用户的系统语言始终是用户的主要使用语言，因此作为默认的耳机播放语言是合理的
- 大多数用户在使用翻译应用时，语言对的左侧语言与系统语言一致
- 用户在首页和语音页面看到的设置选项应该保持一致，以避免混淆
- 蓝牙耳机连接状态可以通过系统 API 可靠地检测
- 用户的耳机播放语言偏好应该持久化存储，以便在应用重启或耳机重新连接后恢复
- 当用户更改语言对顺序时，更合理的做法是保持用户之前选择的语言（如果该语言仍在新语言对中），而不是强制切换到左侧语言

## 超出范围

- 支持在耳机中同时播放两种语言（双声道分离）
- 根据耳机型号或品牌提供不同的播放策略
- 支持自动识别对话场景并动态切换耳机播放语言
- 支持超过两种语言的同时翻译和播放
- 语音识别准确率的改进（本功能仅关注播放语言的选择逻辑）

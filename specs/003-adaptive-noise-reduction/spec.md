# 功能规格说明：自适应智能降噪

**功能分支**: `003-adaptive-noise-reduction`  
**创建日期**: 2025-10-22  
**状态**: 草案  
**输入**: 用户描述: "我想在翻译产品里设置一个主动开启降噪的功能，当检测到环境嘈杂的时候主动弹出给用户提示是否要开启降噪模式，请你把这个需求细化"

## 用户场景与测试 *(必填)*

### 用户故事 1 - 环境噪音自动检测与提醒 (优先级: P1)

用户在使用翻译功能时（如语音输入翻译、视频翻译等），系统持续监测环境音频水平。当检测到环境噪音超过阈值（如嘈杂的咖啡厅、街道、车站等场景），系统主动弹出提示，询问用户是否启用降噪模式。

**优先级理由**: 这是整个功能的核心价值，能够主动识别噪音并引导用户改善翻译质量。这是MVP的基础，没有这个功能，其他功能都无意义。

**独立测试**: 可以通过以下方式独立测试：在嘈杂环境中使用翻译功能，验证系统是否在3-5秒内弹出降噪提示，用户点击"开启"后验证降噪是否生效。

**验收场景**:

1. **假设** 用户在安静环境中使用语音翻译功能，**当** 环境噪音水平正常（如<50dB），**则** 系统不显示降噪提示，正常进行翻译
2. **假设** 用户在咖啡厅使用翻译功能，**当** 环境噪音水平持续超过阈值5秒以上（如>70dB），**则** 系统弹出提示"检测到环境噪音较大，是否开启降噪模式以提升识别准确率？"
3. **假设** 系统弹出降噪提示，**当** 用户点击"开启降噪"按钮，**则** 系统立即启用降噪功能，并显示"降噪模式已开启"的反馈
4. **假设** 系统弹出降噪提示，**当** 用户在10秒内没有做任何操作，**则** 提示自动淡出消失，系统继续正常翻译
5. **假设** 系统弹出降噪提示，**当** 用户第一次点击"不需要"按钮，**则** 系统关闭提示，5分钟内不再弹出
6. **假设** 用户第一次点击"不需要"后过了5分钟，**当** 系统仍检测到噪音超过阈值5秒，**则** 系统再次弹出降噪提示
7. **假设** 系统第二次弹出降噪提示，**当** 用户再次点击"不需要"，**则** 系统在本次会话中不再弹出降噪提示
8. **假设** 用户点击"不需要"或忽略提示后，**当** 用户从设置菜单手动开启降噪，**则** 降噪功能正常启用

---

### 用户故事 2 - 降噪效果实时反馈 (优先级: P1)

当用户开启降噪模式后，系统在界面上提供视觉反馈，让用户清楚了解降噪功能正在工作。同时，用户应该能够随时手动关闭降噪模式。

**优先级理由**: 这是用户体验的核心部分。用户需要知道降噪是否生效，以及如何控制这个功能。缺少反馈会导致用户困惑和信任度下降。

**独立测试**: 可以通过以下方式独立测试：开启降噪模式后，观察界面上是否有明确的降噪状态指示器，并验证用户能否通过简单操作关闭降噪。

**验收场景**:

1. **假设** 用户开启降噪模式，**当** 降噪功能激活，**则** 界面上显示降噪状态指示器（如"降噪模式"图标或标签）
2. **假设** 降噪模式已开启，**当** 用户在翻译界面点击降噪状态指示器或设置按钮，**则** 显示"关闭降噪"选项
3. **假设** 降噪模式已开启，**当** 用户点击"关闭降噪"，**则** 系统关闭降噪功能，更新界面状态指示器，并继续翻译
4. **假设** 降噪模式已开启，**当** 系统检测到环境噪音降低到正常水平（如<55dB）持续1分钟以上，**则** 系统弹出提示"环境噪音已降低，是否关闭降噪模式？"
5. **假设** 系统弹出"是否关闭降噪"提示，**当** 用户点击"关闭降噪"，**则** 系统立即关闭降噪功能并更新状态指示器
6. **假设** 系统弹出"是否关闭降噪"提示，**当** 用户点击"保持开启"，**则** 系统继续保持降噪状态，不再重复提示（除非用户手动关闭后再次开启）
7. **假设** 系统弹出"是否关闭降噪"提示，**当** 用户10秒内没有操作（提示自动消失），**则** 系统在5分钟内不再弹出此提示，5分钟后如果环境仍保持安静，再次弹出提示
8. **假设** 用户第二次忽略"是否关闭降噪"提示，**当** 10秒后提示自动消失，**则** 系统在本次会话中不再重复提示，保持降噪开启状态（除非用户手动关闭后再次开启）

---

### 用户故事 3 - 降噪状态记忆与恢复 (优先级: P1)

系统需要记住用户上次使用时的降噪开启/关闭状态，当用户下次启动应用或重新进入翻译功能时，自动恢复上次的降噪状态。这样可以避免用户每次都需要重新设置。

**优先级理由**: 这是用户体验的重要组成部分。如果用户习惯使用降噪功能，每次都需要重新开启会非常不便。状态记忆是基础功能，应该在MVP中实现。

**独立测试**: 可以通过以下方式独立测试：开启降噪模式，完全退出应用，重新启动应用并进入翻译功能，验证降噪状态是否自动恢复。

**验收场景**:

1. **假设** 用户在上次使用时开启了降噪模式，**当** 用户退出应用后重新启动，**则** 系统自动恢复降噪开启状态，并显示降噪状态指示器
2. **假设** 用户在上次使用时关闭了降噪模式，**当** 用户退出应用后重新启动，**则** 系统保持降噪关闭状态
3. **假设** 用户在上次使用时开启了降噪，**当** 用户切换到其他应用再返回翻译应用，**则** 降噪状态保持不变
4. **假设** 用户首次安装应用，**当** 用户启动翻译功能，**则** 降噪默认为关闭状态，等待用户主动开启或系统提示
5. **假设** 用户卸载并重新安装应用，**当** 用户首次启动，**则** 降噪状态重置为默认关闭状态

---

### 用户故事 4 - 降噪偏好设置与智能学习 (优先级: P2)

用户可以在设置中配置降噪功能的行为偏好，包括是否启用自动提醒、噪音检测灵敏度等。系统还可以学习用户的使用习惯，在特定场景下自动应用用户偏好的设置。

**优先级理由**: 这是提升个性化体验的功能，但对于基础功能来说不是必需的。用户可以先使用默认设置，后续再根据需要调整。

**独立测试**: 可以通过以下方式独立测试：进入设置页面，修改降噪相关设置，验证设置是否保存并在下次使用时生效。

**验收场景**:

1. **假设** 用户打开应用设置，**当** 用户找到"降噪设置"选项，**则** 可以看到"自动检测噪音并提醒"、"噪音检测灵敏度"、"默认开启降噪"等配置项
2. **假设** 用户在设置中关闭"自动检测噪音并提醒"，**当** 用户在嘈杂环境中使用翻译，**则** 系统不会弹出降噪提示（但用户仍可手动开启）
3. **假设** 用户在设置中将"噪音检测灵敏度"调整为"高"，**当** 环境噪音略微升高（如>60dB），**则** 系统更快触发降噪提示
4. **假设** 用户在设置中开启"默认开启降噪"，**当** 用户启动翻译功能，**则** 降噪模式自动开启，无需等待提示
5. **假设** 用户多次在嘈杂环境中主动选择开启降噪，**当** 系统检测到类似噪音环境模式（如连续3次），**则** 系统记录用户偏好，下次自动建议或直接开启降噪

---

### 用户故事 5 - 降噪模式与其他功能的联动 (优先级: P2)

降噪功能需要与翻译产品的其他功能协同工作，例如在视频翻译的"专注翻译模式"下、在连接蓝牙耳机时等场景，系统应智能调整降噪策略。

**优先级理由**: 这是功能整合的优化，确保降噪功能在各种使用场景下都能合理工作。但对于独立功能测试来说，可以后期集成。

**独立测试**: 可以通过以下方式独立测试：在不同翻译场景（语音翻译、视频翻译、耳机模式等）下开启降噪，验证功能是否正常工作且不冲突。

**验收场景**:

1. **假设** 用户正在使用视频翻译的"专注翻译模式"（防打断模式），**当** 系统检测到环境噪音，**则** 自动启用降噪，不弹出提示（因为专注模式下避免打扰）
2. **假设** 用户连接了蓝牙耳机，**当** 系统检测到环境噪音，**则** 降噪提示说明"检测到噪音，开启降噪可改善耳机中的播报质量"
3. **假设** 用户在语音输入翻译时开启降噪，**当** 用户切换到视频翻译模式，**则** 降噪状态保持（不需要重新开启）
4. **假设** 用户在降噪模式下使用智能问答功能，**当** 用户提问，**则** 降噪功能专注于过滤用户语音输入中的背景噪音，保持问答准确性

---

### 边界情况

- 当用户在极度嘈杂的环境中（如演唱会、施工现场，>90dB），降噪功能无法有效改善识别准确率时，系统如何提示？
- 当用户频繁忽略降噪提示（如连续10次让提示自动消失），系统是否应该暂时停止自动提示？
- 当用户在"不需要"后的5分钟冷却期内手动开启降噪，下次检测到噪音时是否应该重置提示策略？
- 当用户点击"保持开启"后，环境噪音再次波动（如短暂升高又降低），是否会再次触发关闭降噪提示？
- 当降噪开启后，噪音水平在正常和嘈杂之间反复波动（如在55dB和75dB之间跳动），系统如何避免频繁弹出提示？
- 当用户频繁切换开启/关闭降噪（如短时间内超过5次），系统是否应该停止自动提示并建议用户使用手动模式？
- 当提示弹出时用户正在进行关键操作（如语音输入中），提示是否应该推迟显示或延长自动消失时间？
- 当用户切换到新的会话时，之前点击"不需要"的记录是否应该清除？
- 当设备麦克风权限被拒绝或麦克风硬件故障时，噪音检测功能如何处理？
- 当用户在通话过程中使用翻译应用，系统如何区分电话语音和环境噪音？
- 当多个翻译功能同时使用（如同时进行语音翻译和视频翻译），降噪设置如何统一管理？
- 当用户在开启降噪后，立即进入飞行模式或网络断开，降噪功能是否仍然工作？
- 当系统在后台运行时检测到噪音，是否应该发送通知提醒用户开启降噪？
- 当用户设备电量低于20%时，降噪功能（可能消耗额外资源）是否应该自动关闭或降低性能？

## 需求 *(必填)*

### 功能需求

- **FR-001**: 系统必须能够实时监测环境音频水平，计算噪音强度（dB值）
- **FR-002**: 系统必须在检测到环境噪音持续超过阈值（默认70dB）超过5秒时，触发降噪提示
- **FR-003**: 系统必须显示清晰的降噪提示弹窗，包含"开启降噪"和"不需要"两个选项
- **FR-004**: 系统必须在降噪提示显示10秒后，如果用户没有做任何操作，提示自动淡出消失
- **FR-005**: 用户点击"开启降噪"后，系统必须立即启用降噪功能，并在界面上显示降噪状态指示器
- **FR-006**: 用户第一次点击"不需要"后，系统必须在5分钟内不再弹出降噪提示
- **FR-007**: 用户第一次点击"不需要"5分钟后，如果系统仍检测到噪音超过阈值5秒，系统必须再次弹出降噪提示
- **FR-008**: 用户第二次点击"不需要"后，系统必须在本次会话中不再弹出降噪提示
- **FR-009**: 用户忽略提示（自动消失）不计入点击"不需要"的次数，系统可以在后续继续弹出提示
- **FR-010**: 系统必须在降噪模式开启时，在主界面上持续显示降噪状态指示器（如图标或文字标签）
- **FR-011**: 用户必须能够通过界面上的控制元素（如状态指示器、设置按钮）随时手动关闭降噪模式
- **FR-012**: 系统必须在降噪模式开启时，持续监测环境噪音水平
- **FR-013**: 系统必须在检测到环境噪音降低到正常水平（默认<55dB）持续1分钟后，弹出提示"环境噪音已降低，是否关闭降噪模式？"，包含"关闭降噪"和"保持开启"两个选项
- **FR-014**: 用户点击"关闭降噪"后，系统必须立即关闭降噪功能并更新界面状态指示器
- **FR-015**: 用户点击"保持开启"后，系统必须继续保持降噪状态，在本次降噪开启周期内不再重复提示（除非用户手动关闭后再次开启）
- **FR-016**: 系统在"是否关闭降噪"提示显示10秒后，如果用户没有操作，提示必须自动消失
- **FR-017**: 用户第一次忽略"是否关闭降噪"提示后，系统必须在5分钟内不再弹出此提示，5分钟后如果环境仍保持安静（<55dB），必须再次弹出提示
- **FR-018**: 用户第二次忽略"是否关闭降噪"提示后，系统必须在本次会话中停止重复提示，保持降噪开启状态（除非用户手动关闭后再次开启）
- **FR-019**: 系统必须将降噪的开启/关闭状态持久化保存到本地存储
- **FR-020**: 系统必须在应用启动或用户进入翻译功能时，自动读取并恢复上次保存的降噪状态
- **FR-021**: 系统必须在首次安装时将降噪状态初始化为关闭状态
- **FR-022**: 系统必须提供设置选项，允许用户配置"自动检测噪音并提醒"的开关状态
- **FR-023**: 系统必须提供设置选项，允许用户调整噪音检测灵敏度（低/中/高三档）
- **FR-024**: 系统必须提供设置选项，允许用户配置"默认开启降噪"功能
- **FR-025**: 系统必须记录用户对降噪提示的响应历史，包括点击"开启降噪"、点击"不需要"的次数和时间戳，以及忽略（自动消失）的次数
- **FR-026**: 系统必须在用户连续3次以上在相似噪音环境中选择开启降噪后，识别为用户偏好并提供更智能的建议
- **FR-027**: 系统必须在"专注翻译模式"下自动启用降噪，无需弹出提示
- **FR-028**: 系统必须确保降噪状态在不同翻译模式（语音翻译、视频翻译、问答模式）之间保持一致
- **FR-029**: 系统必须在麦克风权限被拒绝时，禁用噪音检测功能并在设置中显示相应提示
- **FR-030**: 系统必须在极度嘈杂环境（>90dB）且降噪效果有限时，显示友好提示"当前环境噪音过大，建议移步至安静环境以获得更好的翻译效果"

### 核心实体

- **噪音检测器**: 持续监测环境音频，计算实时噪音强度（dB值），并判断是否超过阈值
- **降噪提示**: 弹窗或通知，向用户建议开启或关闭降噪模式，包含用户选择（开启/不需要/关闭/保持开启）
- **降噪状态**: 当前降噪功能的开启/关闭状态，以及相关的视觉指示器，需要持久化保存
- **用户降噪偏好**: 用户在设置中配置的降噪相关选项，包括自动提醒开关、灵敏度、默认开启等
- **降噪历史记录**: 用户在不同环境和场景下对降噪功能的使用记录，用于智能学习
- **噪音环境模式**: 系统识别的环境噪音类型（如安静、一般、嘈杂、极度嘈杂）
- **提示响应历史**: 记录用户对"开启降噪"和"关闭降噪"提示的响应次数、时间和行为

## 成功标准 *(必填)*

### 可衡量的成果

- **SC-001**: 系统在检测到噪音超过阈值后，3秒内显示降噪提示
- **SC-002**: 用户开启降噪模式后，0.5秒内界面显示降噪状态指示器
- **SC-003**: 在嘈杂环境（70-85dB）下开启降噪后，语音识别准确率提升至少15%
- **SC-004**: 降噪提示在10秒后自动消失，过渡动画流畅自然，不影响用户当前操作
- **SC-005**: 90%的用户能够在10秒内理解并操作降噪提示（通过用户测试验证）
- **SC-006**: 用户对降噪提示的响应率达到60%以上（即60%的用户看到提示后会主动做出选择）
- **SC-007**: 降噪功能的额外电量消耗不超过正常翻译功能的10%
- **SC-008**: 系统的噪音检测准确率达到85%以上（与专业噪音检测设备对比测试）
- **SC-009**: 用户在3次使用后，能够熟练使用降噪功能（无需再查看帮助文档），任务完成率>95%
- **SC-010**: 因环境噪音导致的翻译错误投诉减少40%以上
- **SC-011**: 用户对降噪功能的满意度评分达到4.2/5.0以上

## 假设

- 用户设备具备麦克风权限，且麦克风功能正常
- 系统能够访问设备的音频输入流，用于噪音检测和降噪处理
- 用户主要在中等嘈杂环境（60-80dB）下使用翻译功能，这是降噪功能最有效的范围
- 用户理解"降噪"的概念，知道这是用于改善语音识别准确率的功能
- 噪音检测不会显著增加设备电量消耗（通过优化采样频率和算法）
- 降噪算法能够有效区分人声和环境噪音（如车辆声、风声、人群嘈杂声）
- 用户在看到降噪提示后，有足够的时间和注意力做出选择（不会因为正在使用其他功能而错过）
- 系统在不同设备和操作系统上都能准确检测噪音水平（iOS和Android麦克风一致性）

## 超出范围

- 支持用户自定义噪音阈值的精确数值（当前版本仅提供低/中/高三档灵敏度）
- 支持不同类型噪音的智能识别和分类（如风噪、车噪、人声噪音等）
- 支持降噪效果的可视化展示（如波形图、频谱图）
- 支持录音功能中的降噪处理（当前版本仅针对实时翻译场景）
- 支持离线降噪模式（当前版本依赖在线处理）
- 支持多声道音频的降噪处理（当前版本仅支持单声道）
- 支持基于地理位置的自动降噪策略（如在地铁站、机场自动开启）
- 支持与智能硬件（如降噪耳机、外接麦克风）的深度集成和协同降噪
